---
layout: post
title: Cross compiling Windows binaries from Linux
date: '2012-09-30T23:21:00.001-07:00'
author: David Coles
tags:
- Programming
- Windows
- C
- Porting
- MingGW
modified_time: '2012-09-30T23:26:22.449-07:00'
blogger_id: tag:blogger.com,1999:blog-4144304653010663466.post-6658372832488105804
blogger_orig_url: https://blog.dcoles.net/2012/09/cross-compiling-for-windows-from-linux.html
---

Recently I was helping out a friend with some C/C++ programming work for one of his classes. One issue was that his university uses Microsoft Visual Studio as their compiler which causes a bit of a problem if you don't have that installed and want to make sure a particular bit of code&nbsp;actually&nbsp;compiles.<br /><br />Now I could have installed <a href="http://www.microsoft.com/visualstudio/eng/products/visual-studio-express-products">Visual Studio Express Edition</a>&nbsp;(thankfully it seems Microsoft has<a href="http://blogs.msdn.com/b/visualstudio/archive/2012/09/12/visual-studio-express-2012-for-windows-desktop-is-here.aspx"> had a change of heart</a> and decided that you can keep developing desktop apps with the latest 2012 release), though I have rather limited space on my Windows desktop as it's mostly reserved for playing games *grin*. Thus I decided to work out how hard it is to cross compile Windows binaries from a Linux machine.<br /><br />Thankfully, due to the&nbsp;existence&nbsp;of <a href="http://mingw-w64.sourceforge.net/">MingGW-w64</a>, the answer turns out to be "not too hard". First off, on Debian based systems, you'll require the&nbsp;<a href="apturl:mingw-w64">mingw-w64</a> package to be installed. This will install the C compiler as&nbsp;<span style="font-family: Courier New, Courier, monospace;">i686-w64-mingw32-gcc</span> and&nbsp;<span style="font-family: Courier New, Courier, monospace;">x86_64-w64-mingw32-gcc</span> for 32-bit and 64-bit Windows binaries respectively. Now since Windows isn't a Unix operating system, it doesn't have any of the standard headers you might expect, instead &nbsp;MingGW-w64 provides a series of Windows headers and libraries which can be found in either&nbsp;<span style="font-family: Courier New, Courier, monospace;">/usr/i686-w64-mingw32/</span> or&nbsp;<span style="font-family: Courier New, Courier, monospace;">/usr/x86_64-w64-mingw32/</span><span style="font-family: inherit;">. These directories will automatically be included by the compiler, so you shouldn't need to manually specify the include or library directories with -I or -L.</span><br /><span style="font-family: inherit;"><br /></span> <span style="font-family: inherit;">From this point it should just be a case of running something like </span><span style="font-family: Courier New, Courier, monospace;">`i686-w64-mingw32-gcc -o prog.exe prog.c -lwsock32`</span><span style="font-family: inherit;"> to get a binary you can happily run on a Windows machine without any further problems.</span><br /><span style="font-family: inherit;"><br /></span> Here's some hints I found while porting an program from Unix to the Win32 API:<br /><br /><ul><li>You can use <span style="font-family: Courier New, Courier, monospace;">#ifdef _WIN32</span> to check if you're compiling for the Windows API (defined for both the 32-bit and 64-bit compilers).</li><li>Include&nbsp;<span style="font-family: Courier New, Courier, monospace;">winsock2.h</span> for access to the socket API. The POSIX headers don't exist, but most of the standard functions are available.</li><li>Use <span style="font-family: Courier New, Courier, monospace;"><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms741580(v=vs.85).aspx">WSAGetLastError()</a></span> instead of <span style="font-family: Courier New, Courier, monospace;">errno</span><span style="font-family: inherit;">&nbsp;w</span>hen checking why a function failed. While the <span style="font-family: Courier New, Courier, monospace;">errno.h</span> header exists, <span style="font-family: Courier New, Courier, monospace;">errno</span> would always be set to 0.</li><li>You must call <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms742213(v=vs.85).aspx">WSAStartup(...)</a> before you call any socket functions, otherwise they'll return an error and <span style="font-family: Courier New, Courier, monospace;">WSAGetLastError </span>will be&nbsp;<a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms740668(v=vs.85).aspx#WSANOTINITIALISED">WSANOTINITIALISED</a> (10093). At very least you must do something like:<br /><code><pre>&nbsp; &nbsp; // Initialize WinSock API<br />&nbsp; &nbsp; WORD version = MAKEWORD(2, 2);<br />&nbsp; &nbsp; WSADATA wsaData;<br />&nbsp; &nbsp; int err = WSAStartup(version, &amp;wsaData);<br />&nbsp; &nbsp; if (err != 0) {<br />&nbsp; &nbsp; &nbsp; &nbsp; fatal_error("WSAStartup", err);<br />&nbsp; &nbsp; }</pre><code></code></code></li><li>You'll need to use the <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/hh447209(v=vs.85).aspx">Windows Desktop API</a>&nbsp;for everything (no pthreads and such). MingGW-w64 is not a POSIX&nbsp;compatibility&nbsp;environmental&nbsp;like <a href="http://www.cygwin.com/">Cygwin</a>.</li></ul>