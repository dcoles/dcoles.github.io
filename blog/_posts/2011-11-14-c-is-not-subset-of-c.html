---
layout: post
title: C is not a subset of C++
date: '2011-11-14T19:52:00.001-08:00'
author: David Coles
tags: 
modified_time: '2011-11-15T23:38:36.432-08:00'
blogger_id: tag:blogger.com,1999:blog-4144304653010663466.post-8634529368115493106
blogger_orig_url: https://blog.dcoles.net/2011/11/c-is-not-subset-of-c.html
---

This week I've run into two cases where standard C99 and C++98 don't mix:<br /><h3>     Designated Initializers</h3>C99 includes a very handy feature called <a href="http://gcc.gnu.org/onlinedocs/gcc/Designated-Inits.html">designated initializers</a> which allow you to define some, but not all, of the elements of an array or structure at compile time.<br /><br />For example: <br /><blockquote><pre><code>int abc[255] = { [42]=1, [43]=2 };</code></pre></blockquote>or: <br /><blockquote><pre><code>struct xyz {<br />    const char* name;<br />    int age;<br />};<br />struct xyz p = { .name="David", .age=42 };<br /></code></pre></blockquote>[<a href="https://gist.github.com/1366250">Downloadable example</a>]<br /><br />This tends to be kind of handy, especially when trying to bake static structures into your code base (think mappings of enums to strings). The alternative is initialization lists, which require you to know the order of fields in your struct and for you to define values for every field.<br /><br />C++98 unfortunately doesn't support this feature. I've even seen hints that initialization lists are technically a C++03 feature (yet to find a good reference here).<br /><br />On a more positive note C++11 now has support for <a href="http://www2.research.att.com/~bs/C++0xFAQ.html#init-list">initializer lists for classes</a> (such as <code>std::vector</code>) which could certainly be handy in a number of situations... but alas <a href="http://groups.google.com/group/comp.std.c++/browse_thread/thread/8b7331b0879045ad">still no support for designated initializers</a>...<br /><h3>       The stdint header</h3>The stdint header is one of my favorite headers. It solves a number of problems when writing portable C code or when you need to serialize data by allowing you to precisely specify the size of basic data types (such as <code>uint8_t</code>). Sadly it's not in C++98 either, so you either need to wait for your compiler to support TR1 or C++11 or use something like <a href="http://www.boost.org/doc/libs/1_47_0/libs/integer/doc/html/boost_integer/cstdint.html">boost:cstdint</a>. While GCC has supported this feature for quite some time, it's only in VS2010 that the cstdint header was included.<br /><br />Hooray.<br /><br />One other gotcha is that even if your compiler does support the stdint header, you don't get the <a href="http://pubs.opengroup.org/onlinepubs/009695399/basedefs/stdint.h.html#tag_13_48_03_04">macros for integer constant expressions</a>&nbsp;by default (so you can define integer literals without having to append a semi-random number of "l" symbols on to the end). Without this you'll see some fun errors when including certain C99 headers, like: <br /><blockquote><pre><code><br />error: 'UINT64_C' was not declared in this scope<br /></code></pre></blockquote>So what's the solution?<br /><br />Turns out you need to define <code>__STDC_CONSTANT_MACROS</code> prior to including &lt;stdint.h&gt; or &lt;cstdint&gt;: <br /><blockquote><pre><code><br />#define __STDC_CONSTANT_MACROS<br />#include &lt;stdint.h&gt;<br /></code></pre></blockquote>Yuck.<br /><br />I wonder how long it will be until C and C++ diverge into completely incompatible languages.<br /><br /><b>Edit (2011-11-15):</b><br />Torg makes an excellent point that using any C features not supported in C++ is particularly bad for Windows portability. Visual Studio has limited C support outside that required for C++, thus it's not just using C99 features in headers that might be used in C++ code that you need to watch out for, it's being able to compile the code in the first place! If desperate for full C99 support you can take a look at <a href="http://www.mingw.org/">mingw</a>, <a href="http://clang.llvm.org/">clang</a> and the <a href="http://software.intel.com/en-us/articles/c-compilers/">Intel C compiler</a>.<br /><br />Also check out <a href="http://david.tribble.com/text/cdiffs.htm">Incompatibilities Between &nbsp;ISO C and ISO C++</a>&nbsp;for a more extensive listing of C99/C++98 conflicts.